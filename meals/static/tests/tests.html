<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Javascript Tests</title>
	<link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-2.4.1.css">

</head>
<body>
	<div id="qunit"></div>
	<div id="qunit-fixture">
		<!--clear error message on key stroke test-->
		<form>
			<input name="text"/>
			<div class="has-error">Error Text</div>
		</form>
		<!--remove header tests -->
		<ul class="nav nav-tabs">
			<li id='id_tab1_label'><a data-toggle="tab" href="id_tab1">Tab1</a></li>
		</ul>
		<div class="tab-content">
			<div id='id_tab1' class="tab-pane">
				<h1>Tab1</h1>
			<div>
		</div>
		<h1 id="id_home_headline">Meal Lab Home</h1>
		
		<!--switch between metric and imperial height forms and placeholders-->
		<div id='id_height_div'></div>
		<input id='id_weight' type='text' />
		<input id='id_change_rate' type='text' />

		<!--calc tdee-->
		<div id='id_tdee_form_container'>
			<input type='radio' name='unit_type' value='imperial' checked='checked'/>
			<input type='radio' name='gender' value='m' checked='checked'/>
			<input type='text' name='age' value='34'/>
			<input type='text' name='i_weight' value='210'/>
			<input type='text' name='m_weight' value='0'/>
			<input type='text' name='i_height_0' value='5'/>
			<input type='text' name='i_height_1' value='10'/>
			<input type='text' name='m_height' value='0'/>
			<input type='radio' name='activity'  checked='checked'/>
			<input id='id_direction_0' type='radio' name='direction' value='lose'/>
			<input id='id_direction_1' type='radio' name='direction' value='maintain' />
			<input id='id_direction_2' type='radio' name='direction' value='gain' />
			<div id='id_change_rate_form_container'>
				<input class='change_rate' type='text' name='i_change_rate' />
			</div>
			<button id="id_calc_tdee">Calculate</button>
		</div>
		<div id="id_tdee_result"></div>
		<div id="id_change_tdee_result"></div>
		<div id="id_choose_macros_form_container" style="display:none;">
		<!--choose macros -->
		<table>
		<tr><th>Protein</th><td><input id="id_protein_percent" class="choose_macros" type="text" placeholder="%"/></td><input id="id_protein_g" class="choose_macros" type="text" placeholder="g"/><td></td></tr>
		<tr><th>Fat</th><td><input id="id_fat_percent" class="choose_macros" type="text" placeholder="%"/></td><td><input id="id_fat_g" class="choose_macros" type="text" placeholder="g"/></td></tr>
		<tr><th>Carbs</th><td><input id="id_carbs_percent" class="choose_macros" type="text" placeholder="%"/></td><td><input id="id_carbs_g" class="choose_macros" type="text" placeholder="g"/></td></tr>
		</table>
		</div>
	</div>
	<script src="https://code.jquery.com/qunit/qunit-2.4.1.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="../meals.js"></script>
	<script>
		//helper functions
		var fill_activity_direction_rate = function(act_,dir_,rate,rate_unit) {
			$('input[name=activity]').val(act_);
			$('input[value=' + dir_ + ']').prop('checked',true);
			$('input[name=' + rate_unit + '_change_rate]').val(rate);
		}

		var set_up_choose_macros_test = function(input_,value,result_id,result_value) {
			$('#id_choose_macros_form_container').css('display','block');
			$('#' + input_).val(value);
			$('#' + result_id).html(result_value);
			$('#' + input_).trigger('keyup');
		}
	</script>
	<script>
		//choose macros
		QUnit.test("keystroke in protein percentage creates grams in protein g", function (assert) {
			choose_macro_handler();
			set_up_choose_macros_test('id_protein_percent','50','id_change_tdee_result','1935');
			protein_grams = parseFloat($('#id_protein_g').val());
			assert.equal(protein_grams.toFixed(0),242);
		});
		QUnit.test("keystroke in protein grams creates % in protein %", function (assert) {
			choose_macro_handler();
			set_up_choose_macros_test('id_protein_g','241.875','id_change_tdee_result','1935');
			protein_grams = parseFloat($('#id_protein_percent').val());
			assert.equal(protein_grams.toFixed(0),50);
		});

		//error removal tests
		QUnit.test("errors should be hidden on keypress", function (assert) {
			initialize();
			$('input[type="text"]').trigger('keypress');
			assert.equal($('.has-error').is(':visible'), false);
		});

		QUnit.test("errors aren't hidden if no keypress", function (assert) {
			initialize();
			assert.equal($('.has-error').is(':visible'), true);
		});
		//header removal tests	
		QUnit.test("home header hidden on tab select", function (assert) {
			hide_home_header_on_tab_select();
			$('#id_tab1_label').trigger('click');
			assert.equal($('#id_home_headline').is(':visible'), false);
		});
		
		QUnit.test("home header not hidden if tab not selected", function (assert) {
			hide_home_header_on_tab_select();
			assert.equal($('#id_home_headline').is(':visible'), true);
		});
		//imperial to metric switch
		/*
		QUnit.test("imperial metric switch", function(assert) {
			height_input = "<input id='id_height' type='text'>"
			switch_between_imperial_metric(height_input,'metric')
			var weight_placeholder = $('#id_weight').attr('placeholder')
			assert.equal(weight_placeholder,'kg')
			var height_placeholder = $('#id_height').attr('placeholder')
			assert.equal(height_placeholder,'cm')
			var rate_placeholder = $('#id_change_rate').attr('placeholder')
			assert.equal(rate_placeholder,'kg/wk')
		});
		*/
		//convert to metric (no html to test)
		QUnit.test("convert to metric between metric english", function(assert) {
			var in_cm = convert_between_metric_english(2,'in_to_cm'),
			lb_kg = convert_between_metric_english(2,'lb_to_kg');
			kg_lb = convert_between_metric_english(0.90718,'kg_to_lb');

			assert.equal(in_cm.toFixed(5),5.08001);
			assert.equal(lb_kg.toFixed(5),0.90718);
			assert.equal(kg_lb.toFixed(1),2);
		});
		//tdee stuff
		QUnit.test("calculate tdee displays id_choose_macros_form_container", function(assert) {
		
			calc_tdee();
			assert.equal($('#id_choose_macros_form_container').css('display'),'none')
			$('#id_calc_tdee').trigger('click');
			assert.equal($('#id_choose_macros_form_container').css('display'),'block')
		});
		//hide change rate
		QUnit.test("selection of maintaince makes the rate change input disappear", function(assert) {
			change_change_rate_display();	
			$('input[name=i_change_rate]').val('3');
			assert.equal($('#id_change_rate_form_container').css('display'),'block')
			$('#id_direction_1').trigger('click');
			assert.equal($('#id_change_rate_form_container').css('display'),'none')
			assert.equal($('input[name=i_change_rate').val(),'')
		});
		//show change rate
		QUnit.test("selection of lose or gain makes the rate change input appear", function(assert) {
			change_change_rate_display();	
			$('#id_change_rate_form_container').css('display','none');
			$('#id_direction_0').trigger('click');
			assert.equal($('#id_change_rate_form_container').css('display'),'block')
		});
		QUnit.test("selection of lose or gain if change_rate not hidden then nothing", function(assert) {
			change_change_rate_display();	
			$('#id_direction_0').trigger('click');
			assert.equal($('#id_change_rate_form_container').css('display'),'block')
			$('#id_direction_2').trigger('click');
			assert.equal($('#id_change_rate_form_container').css('display'),'block')
		});
		//calc tdees
		QUnit.test("calculate tdee male at none activity lose 1lb/wk", function(assert) {
			calc_tdee();
			fill_activity_direction_rate('none','lose','1','i');
			$('#id_calc_tdee').trigger('click');
			var result1 = $('#id_tdee_result').html(),
			result2 = $('#id_change_tdee_result').html();
			assert.equal(parseFloat(result1).toFixed(0),2435);
			assert.equal(parseFloat(result2).toFixed(0),1935);
		});
		QUnit.test("calculate tdee male at none activity lose 1lb/wk in metric", function(assert) {
			calc_tdee();
			$('input[name=unit_type]').val('metric');
			$('input[name=m_height]').val(convert_between_metric_english(70,'in_to_cm'));
			$('input[name=m_weight]').val(convert_between_metric_english(210,'lb_to_kg'));
			$('input[name=i_change_rate]').attr('id','id_tmp').attr('name','m_change_rate');
			fill_activity_direction_rate('none','lose',convert_between_metric_english(1,'lb_to_kg'),'m');
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_change_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),1935);
		});
		QUnit.test("calculate tdee male at none activity lose 2lb/wk", function(assert) {
		
			calc_tdee();
			fill_activity_direction_rate('none','lose','2','i');
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_change_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),1435);
		});
		QUnit.test("calculate tdee male at none activity gain 1.5/wk", function(assert) {
		
			calc_tdee();
			fill_activity_direction_rate('none','gain','1.5','i');
			$('input[name=direction]').val('gain')
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_change_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),3185);
		});
		QUnit.test("calculate tdee male at none activity maintain weight", function(assert) {
		
			calc_tdee();
			fill_activity_direction_rate('none','maintain','0','i');
			$('input[name=direction]').val('maintain')
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),2435);
		});
		QUnit.test("calculate tdee female at none activity maintain weight", function(assert) {
		
			calc_tdee();
			fill_activity_direction_rate('none','maintain','0','i');
			$('input[name=gender]').val('f')
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),2076);

		});
		QUnit.test("calculate tdee male at light activity maintain weight", function(assert) {
			calc_tdee();
			fill_activity_direction_rate('light','maintain','0','i');
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),2790);
		});
		QUnit.test("calculate tdee male at medium activity maintain weight", function(assert) {
			calc_tdee();
		
			fill_activity_direction_rate('medium','maintain','0','i');
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),3145);
		});
		QUnit.test("calculate tdee male at high activity maintain weight", function(assert) {
		
			calc_tdee();
			fill_activity_direction_rate('high','maintain','0','i');
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),3500);
		});
		QUnit.test("calculate tdee male at very high activity maintain weight", function(assert) {
		
			calc_tdee();
			fill_activity_direction_rate('very high','maintain','0','i');
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),3855);
		});
	</script>
</body>
</html>

