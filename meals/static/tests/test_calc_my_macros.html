<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Javascript Tests</title>
	<link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-2.4.1.css">

	<script>
		//helper functions
		var fill_activity_direction_rate = function(act_,dir_,rate,rate_unit) {
			$('input[name=activity]').val(act_);
			$('input[value=' + dir_ + ']').prop('checked',true);
			$('input[name=' + rate_unit + '_change_rate]').val(rate);
		}

		var set_up_choose_macros_test = function(input_,value,result_id,result_value) {
			$('#id_choose_macros_form_container').css('display','block');
			$('#' + input_).val(value);
			$('#' + result_id).html(result_value);
			$('#' + input_).trigger('keyup');
		}
		
		var setup_set_cals_form = function() {
			display_set_cals_form();
			$('#id_change_tdee_result').html('1935');
			$('#id_meal_template_meals_number').val('5');
			$('#id_meal_template_set_cals_continue_button').trigger('click');
		}
	</script>
	<script src="https://code.jquery.com/qunit/qunit-2.4.1.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="../meals/js/calc_my_macros.js"></script>
</head>
<body>
	<div id="qunit"></div>
	<div id="qunit-fixture">
		<!--clear error message on key stroke test-->
		<form>
			<input name="text"/>
			<div class="has-error">Error Text</div>
		</form>
		
		<!--calc macros - switch between metric and imperial height forms and placeholders-->
		<input id='unit-type-metric-test' type='radio' name='unit-type' value='metric' />
		<input id='unit-type-imperial-test' type='radio' name='unit-type' value='imperial' />
		<div id='height-input'></div>
		<div id='weight-input'></div>
		<div id='change-rate'></div>

		<!--calc macros - calc tdee-->
		<div id='tdee-form-container'>
			<div id="unit-type-div">
			<input id='unit-type-1' type='radio' name='unit-type' value='imperial' checked='checked'/>
			<input id='unit-type-2' type='radio' name='unit-type' value='metric'/>
			</div>
			<div id="gender-div">
			<input id='gender-1' type='radio' name='gender' value='m' checked='checked'/>
			<input id='gender-2'type='radio' name='gender' value='f' />
			</div>
			<div id="age-div"><label for='age'>Age:</label><input id='age' type='text' name='age' value='34' data-type='number' /></div>
			<div id="weight-div"><label for='weight'>Weight:</label><span id="weight"><input id='i-weight' type='text' name='i-weight' value='210' data-type='number'/>
			<input type='text' name='m-weight' value='0' data-type='number'/></span>
			</div>
			<div id="height-div"><label for='height'>Height:</label><span id="height"><input id='i-height' type='text' name='i-height-0' value='5' data-type='number'/>
			<input type='text' name='i-height-1' value='10' data-type='number'/>
			<input type='text' name='m-height' value='0' data-type='number'/>
			</span></div>
			<div id="activity-div"><input type='radio' name='activity'  checked='checked'/></div>
			<div id="direction-div"><input id='direction-0' type='radio' name='direction' value='lose'/>
			<input id='direction-1' type='radio' name='direction' value='maintain' checked='checked' />
			<input id='direction-2' type='radio' name='direction' value='gain' />
			</div>
			<div id='change-rate-div'><label for='change-rate'>Rate</label><span id='change-rate'>
				<input id='i-change-rate' class='change-rate' type='text' name='i-change-rate' value='1' data-type='number' />
			</div>
			<button id="calc-tdee">Calculate</button>
			<!--<button id="calc-tdee" >Calculate</button>-->

		</div>
		<div id="tdee-result"></div>
		<div id="change-tdee-result"></div>
		<div id="choose-macros-form-container" style="display:none;">
		<!--choose macros -->
		<label for='protein-percent'>Protein</label><input id="protein-percent" class="choose-macros" type="text" placeholder="%" data-value="0" data-type="number" />
		<input id="protein-g" class="choose-macros" type="text" placeholder="g" data-type="number"/>
		<label for='fat-percent'>Fat</label><input id="fat-percent" class="choose-macros" type="text" placeholder="%" data-value="0" data-type="number"/>
		<input id="fat-g" class="choose-macros" type="text" placeholder="g" data-type="number"/>
		<label for='carbs-percent'>Carbs</label><input id="carbs-percent" class="choose-macros" type="text" placeholder="%" data-value="0" data-type="number"/>
		<input id="carbs-g" class="choose-macros" type="text" placeholder="g" data-type="number"/>
		<label for='macro-percent-total'>Total</label></th><td><span id='macro-percent-total'>100</span>

		<button id="choose-macros-continue-button" disabled>Continue</button>
		</div>
	</div>
	

	<!--calc macros - Continue button reveals meal/snack number input -->
	<button id='choose-macros-continue-button' class='btn'>Continue</button>
	<div id="meal-template-meals-number-form-container" style="display:none">
		<input id='meal-template-meals-number' type='text' data-type="number">
		<button id='meal-template-set-cals-continue-button' class='btn' disabled>Continue</button>
	</div>
	<!--calc macros - set cals for daily meals-->
	<div id="meal-template-set-meal-cals-form-container"></div>

	<!-- form errors-->
	<div id="client-side-form-errors"></div>
	<!--end of test mocks-->
	<!------------------------------------------------------------------------------------------------------------------ -->
	<!------------------------------------------------------------------------------------------------------------------ -->
	<!--QUnit TESTS -->
	<script>
		//form validation
        /*
		QUnit.test("validates form inputs, test catch empty field", function (assert) {
			calc_tdee();
			$('#id_i_weight').val('');
			$('#id_calc_tdee').trigger('click');
			error = $('#id_client_side_form_errors').html();
			assert.equal(error.includes('Missing Weight Value'),true);
		});
		QUnit.test("validates form inputs, test catch str int field", function (assert) {
			calc_tdee();
			$('#id_i_weight').val('str');
			$('#id_calc_tdee').trigger('click');
			error = $('#id_client_side_form_errors').html();
			assert.equal(error.includes('Weight Field Forbids Non-Numeric Values'),true);
		});
		QUnit.test("validates form inputs, test catch empty radio", function (assert) {
			calc_tdee();
			$('#id_unit_type_1').prop('checked',false);
			$('#id_calc_tdee').trigger('click');
			error = $('#id_client_side_form_errors').html();
			assert.equal(error.includes('Unit Type Option Needs To Be Selected'),true);
		});
		//Set Calories form (note: meal_template_set_cals_totaler is initiated inside display_set_cals_form()
		QUnit.test("If set cals total not equal to 0 the total is red, but returns to black once 0 again", function (assert) {
			setup_set_cals_form();
			$('input[name=meal_0]').val('390');
			$('input[name=meal_0]').trigger('keyup');
			assert.equal($('#id_meal_template_set_cals_total').css('color'), 'rgb(255, 0, 0)');

			$('input[name=meal_0]').val('387');
			$('input[name=meal_0]').trigger('keyup');
			assert.equal($('#id_meal_template_set_cals_total').css('color'), 'rgb(0, 0, 0)');
			
		});
		QUnit.test("If set cals total not equal to 0 the 'Save Macros' button is disabled", function (assert) {
			setup_set_cals_form();
			assert.equal($('#id_save_my_macros_button').prop('disabled'), false);
			$('input[name=meal_0]').val('390');
			$('input[name=meal_0]').trigger('keyup');
			assert.equal($('#id_save_my_macros_button').prop('disabled'), true);
			$('input[name=meal_0]').val('387');
			$('input[name=meal_0]').trigger('keyup');
			assert.equal($('#id_save_my_macros_button').prop('disabled'), false);
			
		});
		QUnit.test("Change of values in the set calorie inputs alters the calorie total in the last row of the set cals table", function (assert) {
			setup_set_cals_form();
			$('input[name=meal_0]').val('390');
			$('input[name=meal_0]').trigger('keyup');
			var new_tdee_total = $('#id_meal_template_set_cals_total').html();
			assert.equal(new_tdee_total,-3);

			$('input[name=meal_0]').val('380');
			$('input[name=meal_0]').trigger('keyup');
			var new_tdee_total = $('#id_meal_template_set_cals_total').html();
			assert.equal(new_tdee_total,7);
		});
		QUnit.test("Click Set Calories button displays meal inputs that have evenly distibuted cals", function (assert) {
			setup_set_cals_form();
			var equal_cals = $('input[name=meal_0]').val();
			assert.equal(equal_cals,387);
		});
		QUnit.test("Click Set Calories button displays meal inputs that have 'Meal 1' - n and Remaining Cals labels", function (assert) {
			setup_set_cals_form();
			var last_meal_label = $($('#id_meal_template_set_meal_cals_form_container label')[4]).html(),
			remaining_cals_label = $($('#id_meal_template_set_meal_cals_form_container label')[5]).html();
			assert.equal(last_meal_label,'Meal 5');
			assert.equal(remaining_cals_label,'Remaining Cals');
		});
		QUnit.test("Click Continue creates the same number of inputs elements as the number of meals", function (assert) {
			setup_set_cals_form();
			var set_cals_table_input_num = $('#id_meal_template_set_meal_cals_form_container input').length;
			assert.equal(set_cals_table_input_num,5);
		});
		//Set Calories button becomes enabled when meal number input is filled
		QUnit.test("Continue button becomes enabled upon number input and disabled with str input", function (assert) {
			set_cals_continue_button_is_enabled_upon_input_keyup();
			assert.equal($('#id_meal_template_set_cals_continue_button').is(':enabled'), false);
			$('#id_meal_template_meals_number').val('5');
			$('#id_meal_template_meals_number').trigger('keyup');
			assert.equal($('#id_meal_template_set_cals_continue_button').is(':enabled'), true);

			$('#id_meal_template_meals_number').val('cat');
			$('#id_meal_template_meals_number').trigger('keyup');
			assert.equal($('#id_set_cals_continue_button').is(':enabled'), false);
		});
		
		//Continue button reveals the meal/snacks input div
		QUnit.test("continue button displays macro meals number div", function (assert) {
			continue_button_displays_meal_snack_num_div();
			choose_macro_handler();
			set_up_choose_macros_test('id_protein_percent','50','id_change_tdee_result','1935');
			set_up_choose_macros_test('id_fat_percent','20','id_change_tdee_result','1935');
			set_up_choose_macros_test('id_carbs_percent','30','id_change_tdee_result','1935');
			assert.equal($('#id_meal_template_meals_number_form_container').is(':visible'), false);
			$('#id_choose_macros_continue_button').trigger('click');
			assert.equal($('#id_meal_template_meals_number_form_container').is(':visible'), true);
		});

		//choose macros
		QUnit.test("macro_percent_totaler tallys the macro percent total correctly", function (assert) {
			choose_macro_handler();
			set_up_choose_macros_test('id_protein_percent','50','id_change_tdee_result','1935');
			set_up_choose_macros_test('id_fat_percent','20','id_change_tdee_result','1935');
			set_up_choose_macros_test('id_fat_percent','11','id_change_tdee_result','1935');
			percent_total = $('#id_macro_percent_total').html();
			assert.equal(percent_total,'39');
		});
		QUnit.test("macro_percent_totaler doesn't break upon delete", function (assert) {
			choose_macro_handler();
			set_up_choose_macros_test('id_protein_percent','50','id_change_tdee_result','1935');
			set_up_choose_macros_test('id_protein_percent','','id_change_tdee_result','1935');
			percent_total = $('#id_macro_percent_total').html();
			assert.equal(percent_total,'100');
		});
		QUnit.test("choose_percent_totaler enables Continu button if total = 0,disables if not", function (assert) {
			choose_macro_handler();
			set_up_choose_macros_test('id_protein_percent','50','id_change_tdee_result','1935');
			set_up_choose_macros_test('id_fat_percent','25','id_change_tdee_result','1935');
			set_up_choose_macros_test('id_carbs_percent','25','id_change_tdee_result','1935');
			assert.equal($('#id_choose_macros_continue_button').prop('disabled'),false);
			set_up_choose_macros_test('id_carbs_percent','20','id_change_tdee_result','1935');
			assert.equal($('#id_choose_macros_continue_button').prop('disabled'),true);
		});
		
		QUnit.test("keystroke in protein percentage creates grams in protein g", function (assert) {
			choose_macro_handler();
			set_up_choose_macros_test('id_protein_percent','50','id_change_tdee_result','1935');
			protein_grams = parseFloat($('#id_protein_g').val());
			assert.equal(protein_grams.toFixed(0),242);
		});
		QUnit.test("keystroke in protein grams creates % in protein %", function (assert) {
			choose_macro_handler();
			set_up_choose_macros_test('id_protein_g','241.875','id_change_tdee_result','1935');
			protein_grams = parseFloat($('#id_protein_percent').val());
			assert.equal(protein_grams.toFixed(0),50);
		});
		QUnit.test("choose_macro_handler can handle deletes", function (assert) {
			choose_macro_handler();
			set_up_choose_macros_test('id_protein_percent','50','id_change_tdee_result','1935');
			set_up_choose_macros_test('id_protein_percent','','id_change_tdee_result','1935');
			protein_grams = $('#id_protein_g').val();
			assert.equal(protein_grams,'');
			set_up_choose_macros_test('id_protein_g','50','id_change_tdee_result','1935');
			set_up_choose_macros_test('id_protein_g','','id_change_tdee_result','1935');
			protein_percent = $('#id_protein_percent').val();
			assert.equal(protein_percent,'');
		});
		//error removal tests
		QUnit.test("errors should be hidden on keypress", function (assert) {
			key_press_hides_error();
			$('input[type="text"]').trigger('keypress');
			assert.equal($('.has-error').is(':visible'), false);
		});

		QUnit.test("errors aren't hidden if no keypress", function (assert) {
			key_press_hides_error();
			assert.equal($('.has-error').is(':visible'), true);
		});
		//header removal tests	
		QUnit.test("home header hidden on tab select", function (assert) {
			hide_home_header_on_tab_select();
			$('#id_tab1_label').trigger('click');
			assert.equal($('#id_home_headline').is(':visible'), false);
		});
		
		QUnit.test("home header not hidden if tab not selected", function (assert) {
			hide_home_header_on_tab_select();
			assert.equal($('#id_home_headline').is(':visible'), true);
		});
        */
		//imperial to metric switch
		QUnit.test("imperial metric switch", function(assert) {
			switch_between_imperial_metric()
			$('#unit-type-metric-test').trigger('click');
			var weight_placeholder = $('#m-weight').attr('placeholder')
			assert.equal(weight_placeholder,'kg')
			var height_placeholder = $('#m-height').attr('placeholder')
			assert.equal(height_placeholder,'cm')
			var rate_placeholder = $('#m-change-rate').attr('placeholder')
			assert.equal(rate_placeholder,'kg/wk')
		});
		//convert to metric (no html to test)
		QUnit.test("convert to metric between metric english", function(assert) {
			var in_cm = convert_between_metric_english(2,'in-to-cm'),
			lb_kg = convert-between-metric-english(2,'lb-to-kg');
			kg_lb = convert-between-metric-english(0.90718,'kg-to-lb');

			assert.equal(in_cm.toFixed(5),5.08001);
			assert.equal(lb_kg.toFixed(5),0.90718);
			assert.equal(kg_lb.toFixed(1),2);
		});
        /*
		//tdee stuff
		QUnit.test("calculate tdee displays id_choose_macros_form_container", function(assert) {
		
			calc_tdee();
			assert.equal($('#id_choose_macros_form_container').css('display'),'none')
			$('#id_calc_tdee').trigger('click');
			assert.equal($('#id_choose_macros_form_container').css('display'),'block')
		});
		//hide change rate
		QUnit.test("selection of maintaince makes the rate change input disappear", function(assert) {
			change_change_rate_display();	
			$('input[name=i_change_rate]').val('3');
			assert.equal($('#id_change_rate_div').css('display'),'block')

			$('#id_direction_1').trigger('click');
			assert.equal($('#id_change_rate_div').css('display'),'none')
			assert.equal($('input[name=i_change_rate').val(),'')
		});
		//show change rate
		QUnit.test("selection of lose or gain makes the rate change input appear", function(assert) {
			change_change_rate_display();	
			$('#id_change_rate_div').css('display','none');
			$('#id_direction_0').trigger('click');
			assert.equal($('#id_change_rate_div').css('display'),'block')
		});
		QUnit.test("selection of lose or gain if change_rate not hidden then nothing", function(assert) {
			change_change_rate_display();	
			$('#id_direction_0').trigger('click');
			assert.equal($('#id_change_rate_div').css('display'),'block')
			$('#id_direction_2').trigger('click');
			assert.equal($('#id_change_rate_div').css('display'),'block')
		});
		//calc tdees
		QUnit.test("calculate tdee male at none activity lose 1lb/wk", function(assert) {
			calc_tdee();
			fill_activity_direction_rate('none','lose','1','i');
			$('#id_calc_tdee').trigger('click');
			var result1 = $('#id_tdee_result').html(),
			result2 = $('#id_change_tdee_result').html();
			assert.equal(parseFloat(result1).toFixed(0),2435);
			assert.equal(parseFloat(result2).toFixed(0),1935);
		});
		QUnit.test("calculate tdee male at none activity lose 1lb/wk in metric", function(assert) {
			calc_tdee();
			$('input[name=unit_type]').val('metric');
			$('input[name=m_height]').val(convert_between_metric_english(70,'in_to_cm'));
			$('input[name=m_weight]').val(convert_between_metric_english(210,'lb_to_kg'));
			$('input[name=i_change_rate]').attr('id','id_tmp').attr('name','m_change_rate');
			fill_activity_direction_rate('none','lose',convert_between_metric_english(1,'lb_to_kg'),'m');
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_change_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),1935);
		});
		QUnit.test("calculate tdee male at none activity lose 2lb/wk", function(assert) {
		
			calc_tdee();
			fill_activity_direction_rate('none','lose','2','i');
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_change_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),1435);
		});
		QUnit.test("calculate tdee male at none activity gain 1.5/wk", function(assert) {
		
			calc_tdee();
			fill_activity_direction_rate('none','gain','1.5','i');
			$('input[name=direction]').val('gain')
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_change_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),3185);
		});
		QUnit.test("calculate tdee male at none activity maintain weight", function(assert) {
		
			calc_tdee();
			fill_activity_direction_rate('none','maintain','0','i');
			$('input[name=direction]').val('maintain')
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),2435);
		});
		QUnit.test("calculate tdee female at none activity maintain weight", function(assert) {
		
			calc_tdee();
			fill_activity_direction_rate('none','maintain','0','i');
			$('input[name=gender]').val('f')
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),2076);

		});
		QUnit.test("calculate tdee male at light activity maintain weight", function(assert) {
			calc_tdee();
			fill_activity_direction_rate('light','maintain','0','i');
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),2790);
		});
		QUnit.test("calculate tdee male at medium activity maintain weight", function(assert) {
			calc_tdee();
		
			fill_activity_direction_rate('medium','maintain','0','i');
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),3145);
		});
		QUnit.test("calculate tdee male at high activity maintain weight", function(assert) {
		
			calc_tdee();
			fill_activity_direction_rate('high','maintain','0','i');
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),3500);
		});
		QUnit.test("calculate tdee male at very high activity maintain weight", function(assert) {
		
			calc_tdee();
			fill_activity_direction_rate('very high','maintain','0','i');
			$('#id_calc_tdee').trigger('click');
			var result = $('#id_tdee_result').html();
			assert.equal(parseFloat(result).toFixed(5),3855);
		});
        */
	</script>
</body>
</html>

