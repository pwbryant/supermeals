<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Meal Maker Serach Javascript Tests</title>
	<link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-2.4.1.css">
	<script src="https://code.jquery.com/qunit/qunit-2.4.1.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="../../meals/js/meal_maker.js"></script>
    <style>
        .macro-bar-container {
            height: 100%;
            padding-right:3px;
            width: 20%; 
        }
        .macro-area {
            background-color: red;
        }
    </style>
    <script>
        // helper functions
        const test_macro_bars_creation = function(assert, macro, ratio) {

            const bar = d3.select(`#${macro}-goal-macro-bar`);
            const bar_div = $(`#${macro}-bar-container`)
            const div = $('#goal-macros-bar-container')
            const bar_width = div.width() / 5.0;

            console.log($('#fat-goal-macros-bar').attr('height'));
            console.log($('#goal-macros-bar-container').height() );
            
            console.log(div);
            console.log(div.height(),div.css('height'));
            console.log(bar, bar.attr('height'));
            bar.attr('height',function(d) {
                console.log('d',d);
            })
            assert.equal(bar.attr('width'),'100%');
            //assert.equal(bar.attr('width'),'100%');
            //assert.equal(bar.attr('height')/svg.attr('height'),ratio);
        };
    </script>
</head>
<body>
	<div id="qunit"></div>
	<div id="qunit-fixture">
	</div>

	<!--end of test mocks-->
	<!------------------------------------------------------------------------------------------------------------------ -->
	<!------------------------------------------------------------------------------------------------------------------ -->
	<!--QUnit TESTS -->
	<script>
		//bar tests
		//macro goal bars
		QUnit.test("calling create macro bars with create macros labels beneath macro bars", function (assert) {
			MM_FUNK.create_macro_button_trigger();
			fill_macros_add_cals_click_create_button('500',['goal-meal-fat-percent','goal-meal-carbs-percent','goal-meal-protein-percent'],['30','40','30'])
		
            console.log('above asserts');
            const macros = $('.macro-label').map(function(i,d) {
                return $(d).html();

            });
            const amts = $('.macro-amt').map(function(i,d) {
                return $(d).html();

            });
            const units = $('.macro-unit').map(function(i,d) {
                return $(d).html();

            });
            const labels = macros.map(function(i,e) {
                
                if (i == 0) {
                    return e + amts[i];
                } else {

                    return e + amts[i] + units[i-1];
                }
            });
                    
			const cals_label = labels[0];
			const fat_label = labels[1];
			const carbs_label = labels[2];
			const protein_label = labels[3]; 
			assert.equal(cals_label,'Cals: 0');
			assert.equal(fat_label,'Fat: 0g');
			assert.equal(carbs_label,'Carbs: 0g');
			assert.equal(protein_label,'Protein: 0g');
		});
		QUnit.test("calling create macro bars with create macros button creates the macro bars", function (assert) {
			MM_FUNK.create_macro_button_trigger();
			fill_macros_add_cals_click_create_button('500',['goal-meal-fat-percent','goal-meal-carbs-percent','goal-meal-protein-percent'],['30','40','30'])
			test_macro_bars_creation(assert,'cals',1);
			test_macro_bars_creation(assert,'fat',1);
			test_macro_bars_creation(assert,'carbs',1);
			test_macro_bars_creation(assert,'protein',1);
		});

    </script>
</body>
</html>
